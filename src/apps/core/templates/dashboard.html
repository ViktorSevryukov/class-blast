{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% load extra_filters %}

{% block content %}
  {% if user.is_authenticated %}
    {% csrf_token %}
    <div class="table-wrapper">
      <table id="manager-table" class="table table-striped">
        <tr>
          <th></th>
          <th>Course</th>
          <th>AHA Course</th>
          <th>Location</th>
          <th>AHA Location</th>
          <th>Instructor</th>
          <th>AHA Instructor</th>
          <th>Training Center</th>
          <th>Training Site</th>
          <th>Roster Limit</th>
          <th>Cutoff</th>
          <th>Class Description <span class="text-danger">*</span></th>
          <th>Class Notes</th>
        </tr>

        {% for ew_group in ew_groups %}
          <tr id="row-group-{{ ew_group.id }}">
            <td>
              <div class="form-check">
                <input id="check-{{ ew_group.id }}"
                       class="check-control form-check-input"
                       type="checkbox">
              </div>
            </td>
            <td class="td-md"><span>{{ ew_group.course }}</span></td>
            <td class="td-md">
              <select id="aha-course-{{ ew_group.id }}" name="course"
                      class="form-control">
                {% for option in aha_fields.course %}
                  <option
                          {% if option == ew_group.get_default_course %}
                            selected
                          {% endif %}
                            value="{{ option|get_value }}">
                    {{ option|get_text }}
                  </option>
                {% endfor %}
              </select>
            </td>

            <td class="td-md"><span>{{ ew_group.location }}</span></td>
            <td class="td-md">
              <select id="aha-location-{{ ew_group.id }}" name="location"
                      class="form-control">
                {% for option in aha_fields.location %}
                  <option
                          {% if option == ew_group.get_default_location %}
                            selected
                          {% endif %}
                            value="{{ option|get_value }}">
                    {{ option|get_text }}
                  </option>
                {% endfor %}
              </select>
            </td>

            <td class="td-md">{{ ew_group.instructor }}</td>

            <td class="td-md">
              <select id="aha-instructor-{{ ew_group.id }}" name="instructor"
                      class="form-control">
                {% for option in aha_fields.instructor %}
                  <option
                          {% if option == ew_group.get_default_instructor %}
                            selected
                          {% endif %}
                            value="{{ option|get_value }}">
                    {{ option|get_text }}
                  </option>
                {% endfor %}
              </select>
            </td>

            <td class="td-md">
              <select id="aha-tc-{{ ew_group.id }}" name="training_center"
                      class="form-control">
                {% for option in aha_fields.tc %}
                  <option value="{{ option|get_value }}">
                    {{ option|get_text }}
                  </option>
                {% endfor %}
              </select>
            </td>

            <td class="td-md">
              <select id="aha-ts-{{ ew_group.id }}" name="training_site"
                      class="form-control">
                {% for option in aha_fields.ts %}
                  <option value="{{ option|get_value }}">
                    {{ option|get_text }}
                  </option>
                {% endfor %}
              </select>
            </td>

            <td class="td-xs">
              <input id="aha-roster-limit-{{ ew_group.id }}"
                     class="input-sm form-control" name="roster_limit"
                     value={{ ew_group.max_students }}>
            </td>

            <td class="td-sm">
              <input id="aha-cutoff-date-{{ ew_group.id }}"
                     class="input-sm form-control" name="cutoff_date"
                     value={{ ew_group.get_cutoff_date }}>
            </td>

            <td class="td-md">
              <input id="aha-class-description-{{ ew_group.id }}"
                     class="form-control"
                     name="class_description" type="text"
                     size="50">
            </td>

            <td class="td-md">
              <input id="aha-class-notes-{{ ew_group.id }}"
                     class="form-control" name="class_notes" type="text"
                     size="50">
            </td>

          </tr>

        {% endfor %}
      </table>
    </div>

    <div id="controls-panel">

      <div id="loader-wrapper">
        <span>Export in progress... </span>
        <img src="{% static "img/loader.gif" %}"
             id="export-loader" class="loader">
      </div>

      <div id="export-controls">
        <div class="sync-form">
          <form method="post" action={% url 'dashboard:sync' %}>
            {% csrf_token %}
            <button type="submit" class="btn btn-secondary">SYNC</button>
          </form>
        </div>
        <div class="export-form">
          <button class="btn btn-primary" id="export-button"
                  onclick="exportGroups()">Export to AHA
          </button>
        </div>
      </div>
    </div>

  {% endif %}
{% endblock %}



